import{_ as e,e as t}from"./monaco-DG05hfFm.js";import{j as n,h as r,F as o,i,d as a}from"./index-BEf0_EAr.js";import{r as l,A as c,v as s,a4 as d,al as u,R as p,ad as f,a8 as h,$ as y,a6 as m,ab as v,am as x,an as g,a3 as b,ae as j,af as w}from"./antd-es-ClfKr2qc.js";import{o as C,D as O,s as L,r as S}from"./TreeChart-BrpXHSkd.js";const k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM382 896h-.2L232 746.2v-.2h150v150z"}}]},name:"copy",theme:"filled"};var R=function(e,t){return l.createElement(c,s({},e,{ref:t,icon:k}))};const E=l.forwardRef(R);const M={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32zm-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9z"}}]},name:"edit",theme:"filled"};var T=function(e,t){return l.createElement(c,s({},e,{ref:t,icon:M}))};const I=l.forwardRef(T);const P={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 000 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 00391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 00-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]},name:"fullscreen-exit",theme:"outlined"};var N=function(e,t){return l.createElement(c,s({},e,{ref:t,icon:P}))};const z=l.forwardRef(N);const _={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0013.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 000 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 00-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]},name:"fullscreen",theme:"outlined"};var B=function(e,t){return l.createElement(c,s({},e,{ref:t,icon:_}))};const D=l.forwardRef(B),V=({value:e,onChange:t,onFinish:r})=>{const o=l.useRef(null),i=l.useRef(null),[a,c]=l.useState(0);return l.useEffect((()=>{var e;let t=(null==(e=i.current)?void 0:e.offsetWidth)||0;t<80&&(t=80),c(t)}),[e]),l.useEffect((()=>{o.current.focus()}),[]),l.useEffect((()=>{const e=e=>{o.current&&o.current instanceof HTMLElement&&!o.current.contains(e.target)&&r()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[o,r]),n.jsxs("div",{style:{display:"inline-block",padding:"2px"},children:[n.jsx("span",{ref:i,style:{position:"absolute",visibility:"hidden",whiteSpace:"nowrap"},children:e}),n.jsx(d,{ref:o,value:e,onChange:e=>t(e.target.value),onPressEnter:r,onBlur:r,style:{width:`${a+90}px`,lineHeight:"10px",verticalAlign:"middle"}})]})};var H={};function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(H,"__esModule",{value:!0}),H.CopyToClipboard=void 0;var F=$(l),W=$(u),J=["text","onCopy","options","children"];function $(e){return e&&e.__esModule?e:{default:e}}function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){ee(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function X(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Z(e);if(t){var o=Z(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===A(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Y(e)}(this,n)}}function Y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&U(e,t)}(i,F["default"].PureComponent);var t,n,r,o=X(i);function i(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ee(Y(e=o.call.apply(o,[this].concat(n))),"onClick",(function(t){var n=e.props,r=n.text,o=n.onCopy,i=n.children,a=n.options,l=F.default.Children.only(i),c=(0,W.default)(r,a);o&&o(r,c),l&&l.props&&"function"==typeof l.props.onClick&&l.props.onClick(t)})),e}return t=i,(n=[{key:"render",value:function(){var e=this.props;e.text,e.onCopy,e.options;var t=e.children,n=q(e,J),r=F.default.Children.only(t);return F.default.cloneElement(r,K(K({},n),{},{onClick:this.onClick}))}}])&&Q(t.prototype,n),r&&Q(t,r),Object.defineProperty(t,"prototype",{writable:!1}),i}();H.CopyToClipboard=te,ee(te,"defaultProps",{onCopy:void 0,options:void 0});var ne=H.CopyToClipboard;ne.CopyToClipboard=ne;var re=ne;const oe=p.lazy((()=>e((()=>import("./index-BEf0_EAr.js").then((e=>e.k))),__vite__mapDeps([0,1,2,3,4])))),ie=C((({treeStore:e,readonly:c})=>{const s=e.clickNode,[d,u]=l.useState((null==s?void 0:s.data.scriptName)||""),[p,C]=l.useState((null==s?void 0:s.data.scriptText)||""),k=l.useRef(null),[R,M]=l.useState(!1),[T,P]=l.useState(!1),[N,_]=l.useState(!1),[B,H]=l.useState({width:"90vh",height:"80vh"}),[A,F]=l.useState(!1),[W,J]=l.useState(""),[$,G]=l.useState(""),[K,q]=l.useState(""),[Q,U]=l.useState(0),X=()=>{R&&s&&(s.data.scriptName=d,e.setClickNode(s),L(`#node-${s.data.scriptId}`).select("text").text(s.data.scriptName)),M(!R)};l.useEffect((()=>{u((null==s?void 0:s.data.scriptName)||""),(null==s?void 0:s.data.scriptText)&&Y(s.data.scriptText).then((e=>e)),J("")}),[s]);const Y=async e=>{const n=await r(e);k.current&&t.setModelMarkers(k.current.getModel(),"groovy",n)};let Z=!1;const ee=A?"calc(100vh - 320px)":"50vh",te=[{key:(null==s?void 0:s.data.scriptId)||"1",label:"Debug Output",children:n.jsx(oe,{height:"30vh",defaultLanguage:"json",options:{contextmenu:!0,wordWrap:"off",scrollBeyondLastLine:!1,automaticLayout:!0,fontSize:16,readOnly:c},defaultValue:""==$?"":JSON.stringify($,null,2)},Math.random())}],[ne,ie]=l.useState(!0),[ae,le]=l.useState({left:0,top:0,bottom:0,right:0}),ce=l.useRef(null),[se,de]=l.useState(!0),[ue,pe]=l.useState({left:0,top:0,bottom:0,right:0}),fe=l.useRef(null);return n.jsxs("div",{children:[n.jsx(f,{title:n.jsxs("div",{style:{width:"100%",cursor:"move"},onMouseOver:()=>{ne&&ie(!1)},onMouseOut:()=>{ie(!0)},children:[n.jsxs(h,{size:"small",column:1,children:[n.jsx(h.Item,{label:"Node ID",children:n.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[n.jsx("span",{children:null==s?void 0:s.data.scriptId}),n.jsx(y,{title:"复制",children:n.jsx(re.CopyToClipboard,{text:(null==s?void 0:s.data.scriptId)||"",onCopy:()=>{P(!0),setTimeout((()=>P(!1)),5e3)},children:n.jsx(m,{size:"small",type:"link",icon:n.jsx(E,{style:{color:"gray"}})})})}),T&&n.jsx(v,{children:n.jsx(x,{style:{color:"#36f33e",fontSize:"16px"}})})]})}),n.jsx(h.Item,{label:"Node Name",children:n.jsx("div",{style:{display:"flex",alignItems:"center",height:"22px"},children:R?n.jsx(V,{value:d,onChange:e=>{u(e)},onFinish:X}):n.jsxs(n.Fragment,{children:[n.jsx("span",{style:{lineHeight:"32px"},children:d}),n.jsx(m,{size:"small",type:"link",onClick:X,style:{marginLeft:"auto"},children:n.jsx(I,{})})]})})}),n.jsx(h.Item,{label:"Node Type",children:null==s?void 0:s.data.scriptType}),n.jsx(h.Item,{label:"Node Status",children:n.jsx(g,{status:"processing",text:"Running",color:"green"})})]}),n.jsx(m,{type:"text",shape:"circle",onClick:()=>{F(!A),H(A?{width:"90vh",height:"80vh"}:{width:"90vw",height:"100vh"})},icon:A?n.jsx(z,{}):n.jsx(D,{}),style:{position:"absolute",right:"50px",top:"13px"}})]}),centered:!0,maskClosable:!1,open:null!==e.clickNode,onCancel:function(){e.setClickNode(null),U((e=>e+1))},width:B.width,footer:s&&"Start"===s.data.scriptType?null:n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"20px"},children:[n.jsxs("div",{children:[n.jsx(m,{type:"primary",onClick:async()=>{await Y(p)},style:{marginRight:"8px"},children:"编译"}),n.jsx(m,{type:"primary",onClick:async()=>{s.data.scriptText=p,_(!0)},style:{marginRight:"8px"},children:"调试"})]}),n.jsxs("div",{children:[n.jsx(m,{type:"primary",onClick:()=>{s&&(s.data.scriptText=p,e.setClickNode(s),w.success("暂存成功"))},style:{marginRight:"8px"},children:"暂存"}),n.jsx(m,{type:"primary",onClick:function(){e.setClickNode(null),U((e=>e+1)),u(""),C("")},children:"关闭"})]})]}),modalRender:e=>n.jsx(O,{disabled:ne,bounds:ae,nodeRef:ce,onStart:(e,t)=>((e,t)=>{var n;const{clientWidth:r,clientHeight:o}=window.document.documentElement,i=null==(n=ce.current)?void 0:n.getBoundingClientRect();i&&le({left:-i.left+t.x,right:r-(i.right-t.x),top:-i.top+t.y,bottom:o-(i.bottom-t.y)})})(0,t),children:n.jsx("div",{ref:ce,children:e})}),children:!(s&&"Start"===s.data.scriptType)&&n.jsx("div",{style:{border:"1px solid #e1e4e8",background:"#f6f8fa",borderRadius:"4px",padding:"10px",height:ee},children:n.jsx(l.Suspense,{fallback:n.jsx("div",{children:"Loading Editor..."}),children:s&&"rule"==s.data.scriptType?n.jsxs("div",{children:["非rule类型或clickNode不存在时显示的内容",s.data.scriptText]}):n.jsx(oe,{height:ee,onChange:function(e){C(e||"")},onMount:e=>{k.current=e,C(e.getValue()),e.onDidChangeModelContent((async()=>{const t=e.getValue();C(t)})),e.onContextMenu((t=>{Z||(e.addAction({id:"groovy-format",label:"Format Code",contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(e){const t=e.getValue(),n=i(t);e.setValue(n)}}),Z=!0)}))},beforeMount:function(e){S(e)},onValidate:function(e){e.forEach((e=>{}))},defaultLanguage:"groovy",options:{contextmenu:!0,wordWrap:"off",scrollBeyondLastLine:!1,automaticLayout:!0,fontSize:16,readOnly:c},defaultValue:null!==s?s.data.scriptText:""},s?s.data.scriptId:"editor")})})}),n.jsx(f,{title:n.jsx("div",{style:{width:"100%",cursor:"move"},onMouseOver:()=>{se&&de(!1)},onMouseOut:()=>{de(!0)},children:"Debug Node"}),open:N,centered:!0,onCancel:()=>{_(!1),G(""),q("")},maskClosable:!1,footer:null,width:1e3,style:{height:"95vh"},modalRender:e=>n.jsx(O,{disabled:se,bounds:ue,nodeRef:fe,onStart:(e,t)=>((e,t)=>{var n;const{clientWidth:r,clientHeight:o}=window.document.documentElement,i=null==(n=fe.current)?void 0:n.getBoundingClientRect();i&&pe({left:-i.left+t.x,right:r-(i.right-t.x),top:-i.top+t.y,bottom:o-(i.bottom-t.y)})})(0,t),children:n.jsx("div",{ref:fe,children:e})}),children:n.jsxs(b,{name:"Debug Node",autoComplete:"off",layout:"vertical",onFinish:()=>{let e={scriptMetadata:{...s.data,children:null},inputValues:W?JSON.parse(W):{}};a(e).then((e=>{const t=e[1][0];t.scriptId=s.data.scriptId,t.scriptName=s.data.scriptName,G(t),q((null==s?void 0:s.data.scriptId)||"1")}))},children:[n.jsx(b.Item,{name:"jsonInput",label:"JSON Content",children:n.jsx("div",{style:{border:"1px solid #e1e4e8",background:"#f6f8fa",borderRadius:"4px",padding:"10px"},children:n.jsx(o,{height:"300px",defaultLanguage:"json",onChange:function(e){J(e||"")},defaultValue:W,options:{scrollBeyondLastLine:!1,fontSize:16}},s?s.data.scriptId+Q:"jsonInput")})}),n.jsx(b.Item,{children:n.jsx(m,{type:"primary",htmlType:"submit",style:{width:"100%"},children:"Submit"})}),n.jsx(b.Item,{children:n.jsx(j,{onChange:e=>{let t="";t=Array.isArray(e)?e.includes(K)?"":e[0]:K===e?"1":e,q(t)},activeKey:K,bordered:!0,items:te},null==s?void 0:s.data.scriptId)})]})})]})}));export{ie as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-BEf0_EAr.js","assets/antd-es-ClfKr2qc.js","assets/monaco-DG05hfFm.js","assets/monaco-BE7sLzYL.css","assets/index-B0gcK6es.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}