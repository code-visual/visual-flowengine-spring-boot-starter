import{_ as ge,e as me}from"./monaco-JC-Olkkl.js";import{j as r,h as xe,F as ve,d as be}from"./index-izznm4Nv.js";import{r as l,A as O,v as w,a4 as Ce,aj as je,R as Oe,ad as N,a8 as g,$ as we,a6 as h,ab as Le,ak as Ee,al as Se,a3 as b,ae as _e,af as Ie}from"./antd-es-OS8ymY5o.js";import{o as Te,s as Pe,r as Re}from"./TreeChart-FxjS-EI-.js";var Fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM382 896h-.2L232 746.2v-.2h150v150z"}}]},name:"copy",theme:"filled"};const Me=Fe;var ze=function(n,e){return l.createElement(O,w({},n,{ref:e,icon:Me}))};const De=l.forwardRef(ze);var Ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32zm-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9z"}}]},name:"edit",theme:"filled"};const $e=Ve;var ke=function(n,e){return l.createElement(O,w({},n,{ref:e,icon:$e}))};const Be=l.forwardRef(ke);var We={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 000 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 00391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 00-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]},name:"fullscreen-exit",theme:"outlined"};const Ae=We;var He=function(n,e){return l.createElement(O,w({},n,{ref:e,icon:Ae}))};const Ne=l.forwardRef(He);var Je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0013.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 000 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 00-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]},name:"fullscreen",theme:"outlined"};const Ke=Je;var qe=function(n,e){return l.createElement(O,w({},n,{ref:e,icon:Ke}))};const Ge=l.forwardRef(qe),Qe=({value:t,onChange:n,onFinish:e})=>{const o=l.useRef(null),a=l.useRef(null),s=90,[u,p]=l.useState(0);return l.useEffect(()=>{var f;let c=((f=a.current)==null?void 0:f.offsetWidth)||0;c<80&&(c=80),p(c)},[t]),l.useEffect(()=>{o.current.focus()},[]),l.useEffect(()=>{const c=f=>{o.current&&o.current instanceof HTMLElement&&!o.current.contains(f.target)&&e()};return document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[o,e]),r.jsxs("div",{style:{display:"inline-block",padding:"2px"},children:[r.jsx("span",{ref:a,style:{position:"absolute",visibility:"hidden",whiteSpace:"nowrap"},children:t}),r.jsx(Ce,{ref:o,value:t,onChange:c=>n(c.target.value),onPressEnter:e,onBlur:e,style:{width:`${u+s}px`,lineHeight:"10px",verticalAlign:"middle"}})]})};var L={};function R(t){"@babel/helpers - typeof";return R=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},R(t)}Object.defineProperty(L,"__esModule",{value:!0});L.CopyToClipboard=void 0;var C=Q(l),Ue=Q(je),Xe=["text","onCopy","options","children"];function Q(t){return t&&t.__esModule?t:{default:t}}function J(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);n&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),e.push.apply(e,o)}return e}function K(t){for(var n=1;n<arguments.length;n++){var e=arguments[n]!=null?arguments[n]:{};n%2?J(Object(e),!0).forEach(function(o){z(t,o,e[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):J(Object(e)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(e,o))})}return t}function Ye(t,n){if(t==null)return{};var e=Ze(t,n),o,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(a=0;a<s.length;a++)o=s[a],!(n.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(t,o)&&(e[o]=t[o])}return e}function Ze(t,n){if(t==null)return{};var e={},o=Object.keys(t),a,s;for(s=0;s<o.length;s++)a=o[s],!(n.indexOf(a)>=0)&&(e[a]=t[a]);return e}function et(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function q(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function tt(t,n,e){return n&&q(t.prototype,n),e&&q(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function nt(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&F(t,n)}function F(t,n){return F=Object.setPrototypeOf||function(o,a){return o.__proto__=a,o},F(t,n)}function rt(t){var n=at();return function(){var o=j(t),a;if(n){var s=j(this).constructor;a=Reflect.construct(o,arguments,s)}else a=o.apply(this,arguments);return ot(this,a)}}function ot(t,n){if(n&&(R(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return U(t)}function U(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function at(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function j(t){return j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},j(t)}function z(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}var X=function(t){nt(e,t);var n=rt(e);function e(){var o;et(this,e);for(var a=arguments.length,s=new Array(a),u=0;u<a;u++)s[u]=arguments[u];return o=n.call.apply(n,[this].concat(s)),z(U(o),"onClick",function(p){var c=o.props,f=c.text,m=c.onCopy,x=c.children,E=c.options,y=C.default.Children.only(x),S=(0,Ue.default)(f,E);m&&m(f,S),y&&y.props&&typeof y.props.onClick=="function"&&y.props.onClick(p)}),o}return tt(e,[{key:"render",value:function(){var a=this.props;a.text,a.onCopy,a.options;var s=a.children,u=Ye(a,Xe),p=C.default.Children.only(s);return C.default.cloneElement(p,K(K({},u),{},{onClick:this.onClick}))}}]),e}(C.default.PureComponent);L.CopyToClipboard=X;z(X,"defaultProps",{onCopy:void 0,options:void 0});var it=L,M=it.CopyToClipboard;M.CopyToClipboard=M;var lt=M;const G=Oe.lazy(()=>ge(()=>import("./index-izznm4Nv.js").then(t=>t.i),__vite__mapDeps([0,1,2,3,4]))),pt=Te(({treeStore:t,readonly:n})=>{const e=t.clickNode,[o,a]=l.useState((e==null?void 0:e.data.scriptName)||""),[s,u]=l.useState((e==null?void 0:e.data.scriptText)||""),p=l.useRef(null),[c,f]=l.useState(!1),[m,x]=l.useState(!1),[E,y]=l.useState(!1),[S,D]=l.useState({width:"90vh",height:"80vh"}),[v,Y]=l.useState(!1),[_,V]=l.useState(""),[$,k]=l.useState(""),[I,T]=l.useState(""),[Z,B]=l.useState(0),ee=i=>{a(i)},W=()=>{c&&e&&(e.data.scriptName=o,t.setClickNode(e),Pe(`#node-${e.data.scriptId}`).select("text").text(e.data.scriptName)),f(!c)};l.useEffect(()=>{a((e==null?void 0:e.data.scriptName)||""),e!=null&&e.data.scriptText&&A(e.data.scriptText).then(i=>i),V("")},[e]);const A=async i=>{const d=await xe(i);p.current&&me.setModelMarkers(p.current.getModel(),"groovy",d)},te=async()=>{await A(s)},ne=async()=>{e.data.scriptText=s,y(!0)},re=()=>{e&&(e.data.scriptText=s,t.setClickNode(e),Ie.success("暂存成功"))},oe=()=>{x(!0),setTimeout(()=>x(!1),5e3)};function ae(){t.setClickNode(null),B(i=>i+1),a(""),u("")}function ie(){t.setClickNode(null),B(i=>i+1)}function le(i){u(i||"")}function se(i){V(i||"")}const ce=i=>{p.current=i,u(i.getValue()),i.onDidChangeModelContent(async()=>{const d=i.getValue();u(d)})};function ue(i){Re(i)}function de(i){i.forEach(d=>console.log("onValidate:",d.message))}const pe=()=>{Y(!v),D(v?{width:"90vh",height:"80vh"}:{width:"90vw",height:"100vh"})},H=v?"calc(100vh - 320px)":"50vh",fe=()=>{let i={scriptMetadata:{...e.data,children:null},inputValues:_?JSON.parse(_):{}};be(i).then(d=>{const P=d[1][0];P.scriptId=e.data.scriptId,P.scriptName=e.data.scriptName,k(P),T((e==null?void 0:e.data.scriptId)||"1")})},he=[{key:(e==null?void 0:e.data.scriptId)||"1",label:"Debug Output",children:r.jsx(G,{height:"30vh",defaultLanguage:"json",options:{contextmenu:!0,wordWrap:"off",scrollBeyondLastLine:!1,automaticLayout:!0,fontSize:16,readOnly:n},defaultValue:$==""?"":JSON.stringify($,null,2)},Math.random())}],ye=i=>{let d="";Array.isArray(i)?d=i.includes(I)?"":i[0]:d=I===i?"1":i,T(d)};return r.jsxs("div",{children:[r.jsx(N,{title:r.jsxs(r.Fragment,{children:[r.jsxs(g,{size:"small",column:1,children:[r.jsx(g.Item,{label:"Node ID",children:r.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[r.jsx("span",{children:e==null?void 0:e.data.scriptId}),r.jsx(we,{title:"复制",children:r.jsx(lt.CopyToClipboard,{text:(e==null?void 0:e.data.scriptId)||"",onCopy:oe,children:r.jsx(h,{size:"small",type:"link",icon:r.jsx(De,{style:{color:"gray"}})})})}),m&&r.jsx(Le,{children:r.jsx(Ee,{style:{color:"#36f33e",fontSize:"16px"}})})]})}),r.jsx(g.Item,{label:"Node Name",children:r.jsx("div",{style:{display:"flex",alignItems:"center",height:"22px"},children:c?r.jsx(Qe,{value:o,onChange:ee,onFinish:W}):r.jsxs(r.Fragment,{children:[r.jsx("span",{style:{lineHeight:"32px"},children:o}),r.jsx(h,{size:"small",type:"link",onClick:W,style:{marginLeft:"auto"},children:r.jsx(Be,{})})]})})}),r.jsx(g.Item,{label:"Node Type",children:e==null?void 0:e.data.scriptType}),r.jsx(g.Item,{label:"Node Status",children:r.jsx(Se,{status:"processing",text:"Running",color:"green"})})]}),r.jsx(h,{type:"text",shape:"circle",onClick:pe,icon:v?r.jsx(Ne,{}):r.jsx(Ge,{}),style:{position:"absolute",right:"50px",top:"13px"}})]}),centered:!0,maskClosable:!1,open:t.clickNode!==null,onCancel:ie,width:S.width,style:{maxWidth:"100vw",maxHeight:"100vh",overflow:"hidden"},footer:e&&e.data.scriptType==="Start"?null:r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"20px"},children:[r.jsxs("div",{children:[r.jsx(h,{type:"primary",onClick:te,style:{marginRight:"8px"},children:"编译"}),r.jsx(h,{type:"primary",onClick:ne,style:{marginRight:"8px"},children:"调试"})]}),r.jsxs("div",{children:[r.jsx(h,{type:"primary",onClick:re,style:{marginRight:"8px"},children:"暂存"}),r.jsx(h,{type:"primary",onClick:ae,children:"取消"})]})]}),children:!(e&&e.data.scriptType==="Start")&&r.jsx("div",{style:{border:"1px solid #e1e4e8",background:"#f6f8fa",borderRadius:"4px",padding:"10px",height:H},children:r.jsx(l.Suspense,{fallback:r.jsx("div",{children:"Loading Editor..."}),children:e&&e.data.scriptType=="rule"?r.jsxs("div",{children:["非rule类型或clickNode不存在时显示的内容",e.data.scriptText]}):r.jsx(G,{height:H,onChange:le,onMount:ce,beforeMount:ue,onValidate:de,defaultLanguage:"groovy",options:{contextmenu:!0,wordWrap:"off",scrollBeyondLastLine:!1,automaticLayout:!0,fontSize:16,readOnly:n},defaultValue:e!==null?e.data.scriptText:""},e?e.data.scriptId:"editor")})})}),r.jsx(N,{title:"Debug Node",open:E,centered:!0,onCancel:()=>{y(!1),k(""),T("")},maskClosable:!1,footer:null,width:1e3,style:{height:"95vh"},children:r.jsxs(b,{name:"Debug Node",autoComplete:"off",layout:"vertical",onFinish:fe,children:[r.jsx(b.Item,{name:"jsonInput",label:"JSON Content",children:r.jsx("div",{style:{border:"1px solid #e1e4e8",background:"#f6f8fa",borderRadius:"4px",padding:"10px"},children:r.jsx(ve,{height:"500px",defaultLanguage:"json",onChange:se,defaultValue:_,options:{scrollBeyondLastLine:!1,fontSize:16}},e?e.data.scriptId+Z:"jsonInput")})}),r.jsx(b.Item,{children:r.jsx(h,{type:"primary",htmlType:"submit",style:{width:"100%"},children:"Submit"})}),r.jsx(b.Item,{children:r.jsx(_e,{onChange:ye,activeKey:I,bordered:!0,items:he},e==null?void 0:e.data.scriptId)})]})})]})});export{pt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-izznm4Nv.js","assets/antd-es-OS8ymY5o.js","assets/monaco-JC-Olkkl.js","assets/monaco-_aMo4KT6.css","assets/index-dIHCunrD.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}