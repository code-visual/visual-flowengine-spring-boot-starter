import{_ as le,e as ae}from"./monaco-JC-Olkkl.js";import{j as o,f as se,F as ce,h as ue}from"./index-XiwYJS03.js";import{r as l,A as C,v as O,a5 as de,al as pe,R as fe,ab as $,a4 as g,$ as he,ad as h,a8 as ye,am as ge,an as me,a3 as S,aa as R}from"./antd-es-D91rHEc9.js";import{o as ve,s as xe,a as be,r as je}from"./TreeChart-xLD0-OmF.js";var Ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM382 896h-.2L232 746.2v-.2h150v150z"}}]},name:"copy",theme:"filled"};const Oe=Ce;var we=function(n,e){return l.createElement(C,O({},n,{ref:e,icon:Oe}))};const Le=l.forwardRef(we);var Ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32zm-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9z"}}]},name:"edit",theme:"filled"};const _e=Ee;var Se=function(n,e){return l.createElement(C,O({},n,{ref:e,icon:_e}))};const Re=l.forwardRef(Se);var Te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 000 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 00391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 00-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]},name:"fullscreen-exit",theme:"outlined"};const Pe=Te;var Fe=function(n,e){return l.createElement(C,O({},n,{ref:e,icon:Pe}))};const Ie=l.forwardRef(Fe);var Me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0013.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 000 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 00-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]},name:"fullscreen",theme:"outlined"};const ze=Me;var ke=function(n,e){return l.createElement(C,O({},n,{ref:e,icon:ze}))};const De=l.forwardRef(ke),$e=({value:t,onChange:n,onFinish:e})=>{const r=l.useRef(null),i=l.useRef(null),a=90,[u,d]=l.useState(0);return l.useEffect(()=>{var p;let c=((p=i.current)==null?void 0:p.offsetWidth)||0;c<80&&(c=80),d(c)},[t]),l.useEffect(()=>{r.current.focus()},[]),l.useEffect(()=>{const c=p=>{r.current&&r.current instanceof HTMLElement&&!r.current.contains(p.target)&&e()};return document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[r,e]),o.jsxs("div",{style:{display:"inline-block",padding:"2px"},children:[o.jsx("span",{ref:i,style:{position:"absolute",visibility:"hidden",whiteSpace:"nowrap"},children:t}),o.jsx(de,{ref:r,value:t,onChange:c=>n(c.target.value),onPressEnter:e,onBlur:e,style:{width:`${u+a}px`,lineHeight:"10px",verticalAlign:"middle"}})]})};var w={};function T(t){"@babel/helpers - typeof";return T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},T(t)}Object.defineProperty(w,"__esModule",{value:!0});w.CopyToClipboard=void 0;var b=H(l),Ve=H(pe),Be=["text","onCopy","options","children"];function H(t){return t&&t.__esModule?t:{default:t}}function V(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,r)}return e}function B(t){for(var n=1;n<arguments.length;n++){var e=arguments[n]!=null?arguments[n]:{};n%2?V(Object(e),!0).forEach(function(r){I(t,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):V(Object(e)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))})}return t}function We(t,n){if(t==null)return{};var e=He(t,n),r,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(i=0;i<a.length;i++)r=a[i],!(n.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(e[r]=t[r])}return e}function He(t,n){if(t==null)return{};var e={},r=Object.keys(t),i,a;for(a=0;a<r.length;a++)i=r[a],!(n.indexOf(i)>=0)&&(e[i]=t[i]);return e}function Ne(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function W(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ae(t,n,e){return n&&W(t.prototype,n),e&&W(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function qe(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&P(t,n)}function P(t,n){return P=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},P(t,n)}function Ge(t){var n=Ke();return function(){var r=j(t),i;if(n){var a=j(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return Je(this,i)}}function Je(t,n){if(n&&(T(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return N(t)}function N(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function j(t){return j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},j(t)}function I(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}var A=function(t){qe(e,t);var n=Ge(e);function e(){var r;Ne(this,e);for(var i=arguments.length,a=new Array(i),u=0;u<i;u++)a[u]=arguments[u];return r=n.call.apply(n,[this].concat(a)),I(N(r),"onClick",function(d){var c=r.props,p=c.text,m=c.onCopy,v=c.children,L=c.options,y=b.default.Children.only(v),E=(0,Ve.default)(p,L);m&&m(p,E),y&&y.props&&typeof y.props.onClick=="function"&&y.props.onClick(d)}),r}return Ae(e,[{key:"render",value:function(){var i=this.props;i.text,i.onCopy,i.options;var a=i.children,u=We(i,Be),d=b.default.Children.only(a);return b.default.cloneElement(d,B(B({},u),{},{onClick:this.onClick}))}}]),e}(b.default.PureComponent);w.CopyToClipboard=A;I(A,"defaultProps",{onCopy:void 0,options:void 0});var Qe=w,F=Qe.CopyToClipboard;F.CopyToClipboard=F;var Ue=F;const Xe=fe.lazy(()=>le(()=>import("./index-XiwYJS03.js").then(t=>t.i),__vite__mapDeps([0,1,2,3,4]))),nt=ve(({treeStore:t,readonly:n})=>{const e=t.clickNode,[r,i]=l.useState((e==null?void 0:e.data.scriptName)||""),[a,u]=l.useState((e==null?void 0:e.data.scriptText)||""),d=l.useRef(null),[c,p]=l.useState(!1),[m,v]=l.useState(!1),[L,y]=l.useState(!1),E=s=>{i(s)},M=()=>{c&&e&&(e.data.scriptName=r,t.setClickNode(e),be(`#node-${e.data.scriptId}`).select("text").text(e.data.scriptName)),p(!c)};l.useEffect(()=>{i((e==null?void 0:e.data.scriptName)||""),e!=null&&e.data.scriptText&&z(e.data.scriptText).then(s=>s)},[e]);const z=async s=>{const f=await se(s);d.current&&ae.setModelMarkers(d.current.getModel(),"groovy",f)},q=async()=>{await z(a)},G=async()=>{y(!0)},J=()=>{e&&(e.data.scriptText=a,t.setClickNode(e),R.success("暂存成功"))},K=()=>{v(!0),setTimeout(()=>v(!1),5e3)};function Q(){t.setClickNode(null),i(""),u("")}function U(s){u(s||"")}const X=s=>{d.current=s,u(s.getValue()),s.onDidChangeModelContent(async()=>{const f=s.getValue();u(f)})};function Y(s){je(s)}function Z(s){s.forEach(f=>console.log("onValidate:",f.message))}const[ee,k]=l.useState({width:"90vh",height:"80vh"}),[x,te]=l.useState(!1),ne=()=>{te(!x),k(x?{width:"90vh",height:"80vh"}:{width:"90vw",height:"100vh"})},D=x?"calc(100vh - 320px)":"50vh",re=s=>{const{jsonInput:f}=s;console.log("Received values of form: ",s,f);let oe={code:e.data.scriptText,inputValues:f?JSON.parse(f):{}};ue(oe).then(ie=>{ie?R.success("调试成功").then(_=>_):R.error("调试失败").then(_=>_)})};return o.jsxs("div",{children:[o.jsx($,{title:o.jsxs(o.Fragment,{children:[o.jsxs(g,{size:"small",column:1,children:[o.jsx(g.Item,{label:"Node ID",children:o.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[o.jsx("span",{children:e==null?void 0:e.data.scriptId}),o.jsx(he,{title:"复制",children:o.jsx(Ue.CopyToClipboard,{text:(e==null?void 0:e.data.scriptId)||"",onCopy:K,children:o.jsx(h,{size:"small",type:"link",icon:o.jsx(Le,{style:{color:"gray"}})})})}),m&&o.jsx(ye,{children:o.jsx(ge,{style:{color:"#36f33e",fontSize:"16px"}})})]})}),o.jsx(g.Item,{label:"Node Name",children:o.jsx("div",{style:{display:"flex",alignItems:"center",height:"22px"},children:c?o.jsx($e,{value:r,onChange:E,onFinish:M}):o.jsxs(o.Fragment,{children:[o.jsx("span",{style:{lineHeight:"32px"},children:r}),o.jsx(h,{size:"small",type:"link",onClick:M,style:{marginLeft:"auto"},children:o.jsx(Re,{})})]})})}),o.jsx(g.Item,{label:"Node Type",children:e==null?void 0:e.data.scriptType}),o.jsx(g.Item,{label:"Node Status",children:o.jsx(me,{status:"processing",text:"Running",color:"green"})})]}),o.jsx(h,{type:"text",shape:"circle",onClick:ne,icon:x?o.jsx(Ie,{}):o.jsx(De,{}),style:{position:"absolute",right:"50px",top:"13px"}})]}),centered:!0,maskClosable:!1,open:t.clickNode!==null,onCancel:()=>t.setClickNode(null),width:ee.width,style:{maxWidth:"100vw",maxHeight:"100vh",overflow:"hidden"},footer:e&&e.data.scriptType==="Start"?null:o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"20px"},children:[o.jsxs("div",{children:[o.jsx(h,{type:"primary",onClick:q,style:{marginRight:"8px"},children:"编译"}),o.jsx(h,{type:"primary",onClick:G,style:{marginRight:"8px"},children:"调试"})]}),o.jsxs("div",{children:[o.jsx(h,{type:"primary",onClick:J,style:{marginRight:"8px"},children:"暂存"}),o.jsx(h,{type:"primary",onClick:Q,children:"关闭"})]})]}),children:!(e&&e.data.scriptType==="Start")&&o.jsx("div",{style:{border:"1px solid #e1e4e8",background:"#f6f8fa",borderRadius:"4px",padding:"10px",height:D},children:o.jsx(l.Suspense,{fallback:o.jsx("div",{children:"Loading Editor..."}),children:o.jsx(Xe,{height:D,onChange:U,onMount:X,beforeMount:Y,onValidate:Z,defaultLanguage:"groovy",options:{contextmenu:!0,wordWrap:"off",scrollBeyondLastLine:!1,automaticLayout:!0,fontSize:16,readOnly:n},defaultValue:e!==null?e.data.scriptText:""},e?e.data.scriptId:"editor")})})}),o.jsx($,{title:"Debug Node",open:L,centered:!0,onCancel:()=>{y(!1)},maskClosable:!1,footer:null,width:1e3,style:{height:"80vh"},children:o.jsxs(S,{name:"Debug Node",autoComplete:"off",layout:"vertical",onFinish:re,className:xe.debugForm,children:[o.jsx(S.Item,{name:"jsonInput",label:"JSON Content",children:o.jsx("div",{style:{border:"1px solid #e1e4e8",background:"#f6f8fa",borderRadius:"4px",padding:"10px"},children:o.jsx(ce,{height:"500px",defaultLanguage:"json",options:{scrollBeyondLastLine:!1,fontSize:16}})})}),o.jsx(S.Item,{children:o.jsx(h,{type:"primary",htmlType:"submit",style:{width:"100%"},children:"Submit"})})]})})]})});export{nt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-XiwYJS03.js","assets/antd-es-D91rHEc9.js","assets/monaco-JC-Olkkl.js","assets/monaco-_aMo4KT6.css","assets/index-92AB8_x1.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}