import{_ as e,e as t}from"./monaco-DG05hfFm.js";import{j as n,h as r,F as o,d as i}from"./index-BWIyky4r.js";import{r as a,A as l,v as c,a4 as s,al as d,R as u,ad as p,a8 as f,$ as h,a6 as y,ab as m,am as v,an as x,a3 as b,ae as g,af as j}from"./antd-es-ClfKr2qc.js";import{o as w,D as C,s as L,r as O}from"./TreeChart-C6HF1UZY.js";const S={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM382 896h-.2L232 746.2v-.2h150v150z"}}]},name:"copy",theme:"filled"};var k=function(e,t){return a.createElement(l,c({},e,{ref:t,icon:S}))};const R=a.forwardRef(k);const E={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32zm-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9z"}}]},name:"edit",theme:"filled"};var T=function(e,t){return a.createElement(l,c({},e,{ref:t,icon:E}))};const I=a.forwardRef(T);const P={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 000 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 00391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 00-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]},name:"fullscreen-exit",theme:"outlined"};var M=function(e,t){return a.createElement(l,c({},e,{ref:t,icon:P}))};const N=a.forwardRef(M);const z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0013.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 000 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 00-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]},name:"fullscreen",theme:"outlined"};var _=function(e,t){return a.createElement(l,c({},e,{ref:t,icon:z}))};const B=a.forwardRef(_),D=({value:e,onChange:t,onFinish:r})=>{const o=a.useRef(null),i=a.useRef(null),[l,c]=a.useState(0);return a.useEffect((()=>{var e;let t=(null==(e=i.current)?void 0:e.offsetWidth)||0;t<80&&(t=80),c(t)}),[e]),a.useEffect((()=>{o.current.focus()}),[]),a.useEffect((()=>{const e=e=>{o.current&&o.current instanceof HTMLElement&&!o.current.contains(e.target)&&r()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[o,r]),n.jsxs("div",{style:{display:"inline-block",padding:"2px"},children:[n.jsx("span",{ref:i,style:{position:"absolute",visibility:"hidden",whiteSpace:"nowrap"},children:e}),n.jsx(s,{ref:o,value:e,onChange:e=>t(e.target.value),onPressEnter:r,onBlur:r,style:{width:`${l+90}px`,lineHeight:"10px",verticalAlign:"middle"}})]})};var V={};function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(V,"__esModule",{value:!0}),V.CopyToClipboard=void 0;var A=J(a),F=J(d),W=["text","onCopy","options","children"];function J(e){return e&&e.__esModule?e:{default:e}}function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){Z(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function U(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Y(e);if(t){var o=Y(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===H(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return X(e)}(this,n)}}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Q(e,t)}(i,A["default"].PureComponent);var t,n,r,o=U(i);function i(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Z(X(e=o.call.apply(o,[this].concat(n))),"onClick",(function(t){var n=e.props,r=n.text,o=n.onCopy,i=n.children,a=n.options,l=A.default.Children.only(i),c=(0,F.default)(r,a);o&&o(r,c),l&&l.props&&"function"==typeof l.props.onClick&&l.props.onClick(t)})),e}return t=i,(n=[{key:"render",value:function(){var e=this.props;e.text,e.onCopy,e.options;var t=e.children,n=q(e,W),r=A.default.Children.only(t);return A.default.cloneElement(r,K(K({},n),{},{onClick:this.onClick}))}}])&&G(t.prototype,n),r&&G(t,r),Object.defineProperty(t,"prototype",{writable:!1}),i}();V.CopyToClipboard=ee,Z(ee,"defaultProps",{onCopy:void 0,options:void 0});var te=V.CopyToClipboard;te.CopyToClipboard=te;var ne=te;const re=u.lazy((()=>e((()=>import("./index-BWIyky4r.js").then((e=>e.i))),__vite__mapDeps([0,1,2,3,4])))),oe=w((({treeStore:e,readonly:l})=>{const c=e.clickNode,[s,d]=a.useState((null==c?void 0:c.data.scriptName)||""),[u,w]=a.useState((null==c?void 0:c.data.scriptText)||""),S=a.useRef(null),[k,E]=a.useState(!1),[T,P]=a.useState(!1),[M,z]=a.useState(!1),[_,V]=a.useState({width:"90vh",height:"80vh"}),[H,A]=a.useState(!1),[F,W]=a.useState(""),[J,$]=a.useState(""),[K,q]=a.useState(""),[G,Q]=a.useState(0),U=()=>{k&&c&&(c.data.scriptName=s,e.setClickNode(c),L(`#node-${c.data.scriptId}`).select("text").text(c.data.scriptName)),E(!k)};a.useEffect((()=>{d((null==c?void 0:c.data.scriptName)||""),(null==c?void 0:c.data.scriptText)&&X(c.data.scriptText).then((e=>e)),W("")}),[c]);const X=async e=>{const n=await r(e);S.current&&t.setModelMarkers(S.current.getModel(),"groovy",n)};const Y=H?"calc(100vh - 320px)":"50vh",Z=[{key:(null==c?void 0:c.data.scriptId)||"1",label:"Debug Output",children:n.jsx(re,{height:"30vh",defaultLanguage:"json",options:{contextmenu:!0,wordWrap:"off",scrollBeyondLastLine:!1,automaticLayout:!0,fontSize:16,readOnly:l},defaultValue:""==J?"":JSON.stringify(J,null,2)},Math.random())}],[ee,te]=a.useState(!0),[oe,ie]=a.useState({left:0,top:0,bottom:0,right:0}),ae=a.useRef(null),[le,ce]=a.useState(!0),[se,de]=a.useState({left:0,top:0,bottom:0,right:0}),ue=a.useRef(null);return n.jsxs("div",{children:[n.jsx(p,{title:n.jsxs("div",{style:{width:"100%",cursor:"move"},onMouseOver:()=>{ee&&te(!1)},onMouseOut:()=>{te(!0)},children:[n.jsxs(f,{size:"small",column:1,children:[n.jsx(f.Item,{label:"Node ID",children:n.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[n.jsx("span",{children:null==c?void 0:c.data.scriptId}),n.jsx(h,{title:"复制",children:n.jsx(ne.CopyToClipboard,{text:(null==c?void 0:c.data.scriptId)||"",onCopy:()=>{P(!0),setTimeout((()=>P(!1)),5e3)},children:n.jsx(y,{size:"small",type:"link",icon:n.jsx(R,{style:{color:"gray"}})})})}),T&&n.jsx(m,{children:n.jsx(v,{style:{color:"#36f33e",fontSize:"16px"}})})]})}),n.jsx(f.Item,{label:"Node Name",children:n.jsx("div",{style:{display:"flex",alignItems:"center",height:"22px"},children:k?n.jsx(D,{value:s,onChange:e=>{d(e)},onFinish:U}):n.jsxs(n.Fragment,{children:[n.jsx("span",{style:{lineHeight:"32px"},children:s}),n.jsx(y,{size:"small",type:"link",onClick:U,style:{marginLeft:"auto"},children:n.jsx(I,{})})]})})}),n.jsx(f.Item,{label:"Node Type",children:null==c?void 0:c.data.scriptType}),n.jsx(f.Item,{label:"Node Status",children:n.jsx(x,{status:"processing",text:"Running",color:"green"})})]}),n.jsx(y,{type:"text",shape:"circle",onClick:()=>{A(!H),V(H?{width:"90vh",height:"80vh"}:{width:"90vw",height:"100vh"})},icon:H?n.jsx(N,{}):n.jsx(B,{}),style:{position:"absolute",right:"50px",top:"13px"}})]}),centered:!0,maskClosable:!1,open:null!==e.clickNode,onCancel:function(){e.setClickNode(null),Q((e=>e+1))},width:_.width,footer:c&&"Start"===c.data.scriptType?null:n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"20px"},children:[n.jsxs("div",{children:[n.jsx(y,{type:"primary",onClick:async()=>{await X(u)},style:{marginRight:"8px"},children:"编译"}),n.jsx(y,{type:"primary",onClick:async()=>{c.data.scriptText=u,z(!0)},style:{marginRight:"8px"},children:"调试"})]}),n.jsxs("div",{children:[n.jsx(y,{type:"primary",onClick:()=>{c&&(c.data.scriptText=u,e.setClickNode(c),j.success("暂存成功"))},style:{marginRight:"8px"},children:"暂存"}),n.jsx(y,{type:"primary",onClick:function(){e.setClickNode(null),Q((e=>e+1)),d(""),w("")},children:"关闭"})]})]}),modalRender:e=>n.jsx(C,{disabled:ee,bounds:oe,nodeRef:ae,onStart:(e,t)=>((e,t)=>{var n;const{clientWidth:r,clientHeight:o}=window.document.documentElement,i=null==(n=ae.current)?void 0:n.getBoundingClientRect();i&&ie({left:-i.left+t.x,right:r-(i.right-t.x),top:-i.top+t.y,bottom:o-(i.bottom-t.y)})})(0,t),children:n.jsx("div",{ref:ae,children:e})}),children:!(c&&"Start"===c.data.scriptType)&&n.jsx("div",{style:{border:"1px solid #e1e4e8",background:"#f6f8fa",borderRadius:"4px",padding:"10px",height:Y},children:n.jsx(a.Suspense,{fallback:n.jsx("div",{children:"Loading Editor..."}),children:c&&"rule"==c.data.scriptType?n.jsxs("div",{children:["非rule类型或clickNode不存在时显示的内容",c.data.scriptText]}):n.jsx(re,{height:Y,onChange:function(e){w(e||"")},onMount:e=>{S.current=e,w(e.getValue()),e.onDidChangeModelContent((async()=>{const t=e.getValue();w(t)}))},beforeMount:function(e){O(e)},onValidate:function(e){e.forEach((e=>{}))},defaultLanguage:"groovy",options:{contextmenu:!0,wordWrap:"off",scrollBeyondLastLine:!1,automaticLayout:!0,fontSize:16,readOnly:l},defaultValue:null!==c?c.data.scriptText:""},c?c.data.scriptId:"editor")})})}),n.jsx(p,{title:n.jsx("div",{style:{width:"100%",cursor:"move"},onMouseOver:()=>{le&&ce(!1)},onMouseOut:()=>{ce(!0)},children:"Debug Node"}),open:M,centered:!0,onCancel:()=>{z(!1),$(""),q("")},maskClosable:!1,footer:null,width:1e3,style:{height:"95vh"},modalRender:e=>n.jsx(C,{disabled:le,bounds:se,nodeRef:ue,onStart:(e,t)=>((e,t)=>{var n;const{clientWidth:r,clientHeight:o}=window.document.documentElement,i=null==(n=ue.current)?void 0:n.getBoundingClientRect();i&&de({left:-i.left+t.x,right:r-(i.right-t.x),top:-i.top+t.y,bottom:o-(i.bottom-t.y)})})(0,t),children:n.jsx("div",{ref:ue,children:e})}),children:n.jsxs(b,{name:"Debug Node",autoComplete:"off",layout:"vertical",onFinish:()=>{let e={scriptMetadata:{...c.data,children:null},inputValues:F?JSON.parse(F):{}};i(e).then((e=>{const t=e[1][0];t.scriptId=c.data.scriptId,t.scriptName=c.data.scriptName,$(t),q((null==c?void 0:c.data.scriptId)||"1")}))},children:[n.jsx(b.Item,{name:"jsonInput",label:"JSON Content",children:n.jsx("div",{style:{border:"1px solid #e1e4e8",background:"#f6f8fa",borderRadius:"4px",padding:"10px"},children:n.jsx(o,{height:"500px",defaultLanguage:"json",onChange:function(e){W(e||"")},defaultValue:F,options:{scrollBeyondLastLine:!1,fontSize:16}},c?c.data.scriptId+G:"jsonInput")})}),n.jsx(b.Item,{children:n.jsx(y,{type:"primary",htmlType:"submit",style:{width:"100%"},children:"Submit"})}),n.jsx(b.Item,{children:n.jsx(g,{onChange:e=>{let t="";t=Array.isArray(e)?e.includes(K)?"":e[0]:K===e?"1":e,q(t)},activeKey:K,bordered:!0,items:Z},null==c?void 0:c.data.scriptId)})]})})]})}));export{oe as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-BWIyky4r.js","assets/antd-es-ClfKr2qc.js","assets/monaco-DG05hfFm.js","assets/monaco-BE7sLzYL.css","assets/index-B0gcK6es.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}